# Инструкция по запуску плейбука
##  Требования
### Сервер:
- Виртуальная машина на Debian 11, с созданным пользователем для ansible (default: user), имеющим права суперпользователя, и утановленным ssh-client'ом
- ip-адрес виртуальной машины

### Рабочее окружение
- Установленный на рабочей машине Ansible в соответствии с инструкцией (https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)
- Пара ssh-ключей для доступа к серверу ( в случае отстутствия - см. инструкцию)

## Инструкция по запуску (MacOS, Linux)
1. Настройка конфигурации для рабоыт Ansible
  - Сгенерировать пару ssh-ключей (приватный и публичный)
    ```ssh-keygen```
  - Прокинуть на удаленную машину свой публичный ключ
    ```ssh-copy-id <user>@<server_ip>```
  - Для того, чтобы Ansible мог выполнять инструкции с повышенными привелегиями, нужно отключить запрос пароля для sudo, для этого на сервере от рута выполните
  ```echo "<user> ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/ansible```
2. Подготовка Ansible плейбука и его запуск
    1. Клонируйте репозиторий с Ansible плейбуком на вашу локальную машину и перейдите в него:
      ```git clone <repository_url>```
      ```cd <repository_directory>```
    Это создаст файл открытого ключа (~/.ssh/id_rsa.pub) и файл закрытого ключа (~/.ssh/id_rsa) в вашем домашнем каталоге.
    3. Настройка файла Inventory:
      - Отредактируйте файл ./inventory/hosts:
        - Вместо ```<server_ip>``` вставьте ip-адрес вашего сервера
        - Вместо ```<ansible_ssh_private_key_file>``` - путь по приватного ключа на вашем компьютере.
    3. Настройка ansible.cfg:
      - Отредактируйте файл, вставив вместо <user> имя созданного вами пользователя на сервере.
3. Проверка доступа к хосту
  1. Для проверки доступа воспользуйтесь командой
     ```ansible host1 -m ping```
4. Запуск плейбука Ansible
   Запустить плейбук:
   ```ansible-playbook -i ./inventory/hosts ./playbooks/main.yml```
     где /inventory/hosts - это путь до файла с указанием хостов, ./playbooks/main.yml - путь до плейбука

## P.S ssh-ключи для задания хранятся в директории ./playbooks/keys.yml в незашифрованном виде для простоты доступа, однако лушией практикой является хранение подобных секретов в  зашифрованном виде, используя ansible-vault.